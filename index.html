<div id="player"></div>

<!-- Cast Button (Now Shows AirPlay Instructions More Clearly) -->
<button id="castButton" style="
  display: block;
  margin: 20px auto;
  padding: 15px 30px;
  font-size: 20px;
  background: #FF0000;
  color: white;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  font-weight: bold;
">
  ðŸ”´ Play on TV
</button>

<script>
  // ===== EXISTING YOUTUBE PLAYER CODE ===== 
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

const PLAYLIST = [
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'mutP7BVOh5k', start: 85 },
    { id: 'tGljmU1N3dM', start: 81 },
    { id: 'O-3g7FQNyQM', start: 59 },
    { id: 'T34k14DSjkk', start: 62 },
    { id: 'PxwVnvcMh3s', start: 52 }
  ];

var player, currentIndex = 0;

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '390',
      width: '640',
      playerVars: {
        autoplay: 1,
        controls: 1,
        vq: 'hd1080',
        preload: 'auto'
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    loadVideo(currentIndex);
    event.target.setPlaybackRate(0.75);
  }

  function loadVideo(index) {
    if (index >= PLAYLIST.length) return;
    const video = PLAYLIST[index];
    player.loadVideoById({ videoId: video.id, startSeconds: video.start });
  }

  function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.ENDED) {
      currentIndex++;
      loadVideo(currentIndex);
    }
    else if (event.data === YT.PlayerState.PLAYING) {
      player.setPlaybackRate(0.75);
    }
  }

  // ===== IMPROVED CAST/AIRPLAY DETECTION =====
  document.getElementById('castButton').addEventListener('click', function() {
    // Detect iOS
    if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
      // Show visual guide for AirPlay
      alert(`To cast from iPhone/iPad:
1. Open Control Center (swipe down from top-right)
2. Tap "Screen Mirroring" 
3. Select your Apple TV

Or in Safari:
1. Tap the Share icon (ðŸ“¤) 
2. Tap "AirPlay"`);
      
    // Detect Android/Chrome
    } else if (window.chrome) {
      try {
        cast.framework.CastContext.getInstance().requestSession();
      } catch {
        alert(`To cast from Android:
1. Tap Chrome's 3-dot menu (â‹®)
2. Select "Cast"
3. Choose your TV`);
      }
    }
  });
</script>
