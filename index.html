<!-- Player Container (existing) -->
<div id="player"></div>

<!-- ===== NEW CAST BUTTON ADDITION ===== -->
<button id="castButton" style="
  display: block;
  margin: 20px auto;
  padding: 15px 30px;
  font-size: 20px;
  background: #FF0000;
  color: white;
  border: none;
  border-radius: 50px;
  cursor: pointer;
  font-weight: bold;
">
  ðŸ”´ Cast to TV
</button>

<script>
  // ===== EXISTING YOUTUBE PLAYER CODE =====
  var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

const PLAYLIST = [
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'dF3j5X_fgf4', start: 1079 },
    { id: 'mutP7BVOh5k', start: 85 },
    { id: 'tGljmU1N3dM', start: 81 },
    { id: 'O-3g7FQNyQM', start: 59 },
    { id: 'T34k14DSjkk', start: 62 },
    { id: 'PxwVnvcMh3s', start: 52 }
  ];

  var player, currentIndex = 0;

  function onYouTubeIframeAPIReady() {
    player = new YT.Player('player', {
      height: '390',
      width: '640',
      playerVars: {
        autoplay: 1,
        controls: 1,
        vq: 'hd1080',
        preload: 'auto'
      },
      events: {
        'onReady': onPlayerReady,
        'onStateChange': onPlayerStateChange
      }
    });
  }

  function onPlayerReady(event) {
    loadVideo(currentIndex);
    event.target.setPlaybackRate(0.75);
    
    // ===== NEW: ADDED WARNING FOR YOUTUBE APP REDIRECT =====
    event.target.addEventListener('onStateChange', function(e) {
      if (window.location.href.match(/youtube\.com/)) {
        alert("You left the playlist! Return to:\n" + 
              "vivektyagi0033.github.io/yoga/");
      }
    });
  }

  function loadVideo(index) {
    if (index >= PLAYLIST.length) return;
    const video = PLAYLIST[index];
    player.loadVideoById({ videoId: video.id, startSeconds: video.start });
  }

  function onPlayerStateChange(event) {
    if (event.data === YT.PlayerState.ENDED) {
      currentIndex++;
      loadVideo(currentIndex);
    }
    else if (event.data === YT.PlayerState.PLAYING) {
      player.setPlaybackRate(0.75);
    }
  }

  // ===== NEW CAST FUNCTIONALITY =====
  document.getElementById('castButton').addEventListener('click', function() {
    if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
      alert("1. Tap the 'Share' icon (ðŸ“¤)\n2. Select 'AirPlay'\n3. Choose your TV");
    } else {
      if (window.chrome && chrome.cast) {
        cast.framework.CastContext.getInstance().requestSession();
      } else {
        alert("1. Tap Chrome's 3-dot menu (â‹®)\n2. Select 'Cast'\n3. Choose your TV");
      }
    }
  });

  // ===== NEW: BLOCK YOUTUBE APP OPENING =====
  document.addEventListener('click', function(e) {
    if (e.target.closest('a[href*="youtube.com"]')) {
      e.preventDefault();
      alert("Please stay on this page to maintain your playlist!");
    }
  });
</script>
